<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS re:Invent 2025 æ’ç¨‹è¡¨ (Excelç‰ˆ)</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        /* åŸºç¤è¨­å®š */
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; margin: 0; padding: 10px; background: #f4f4f4; color: #333; }
        
        /* æ¨™é¡Œèˆ‡æ§åˆ¶å€ */
        h1 { color: #232f3e; border-bottom: 3px solid #ff9900; padding-bottom: 10px; font-size: 1.4rem; margin-top: 0; }
        .control-panel { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px; position: sticky; top: 0; z-index: 100; }
        
        /* ä¸‹æ‹‰é¸å–® */
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 1rem; }
        select { font-size: 16px; padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px; background: #fff; }
        
        /* è¡¨æ ¼å®¹å™¨ */
        .table-container { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        /* è¡¨é ­ */
        th { background: #232f3e; color: white; padding: 12px 8px; text-align: left; font-size: 0.9rem; white-space: nowrap; }
        
        /* è¡¨æ ¼å…§å®¹ */
        td { padding: 12px 8px; border-bottom: 1px solid #eee; vertical-align: top; font-size: 0.95rem; line-height: 1.4; word-wrap: break-word; cursor: pointer; }
        tr:last-child td { border-bottom: none; }
        
        /* äº®é¡¯æ¨£å¼ */
        .highlight { background: #fffbe6; border-left: 5px solid #ff9900; }
        .highlight td { color: #232f3e; }
        .highlight td:first-child { font-weight: bold; } /* æ™‚é–“åŠ ç²— */

        /* éš±è—çš„è©³ç´°èªªæ˜åˆ— */
        .detail-row { display: none; background-color: #f9f9f9; }
        .detail-cell { padding: 10px 15px; font-size: 0.9rem; color: #555; border-bottom: 1px solid #ddd; }
        
        /* è¼‰å…¥ä¸­é®ç½© */
        #loading { text-align: center; padding: 20px; font-weight: bold; color: #666; }

        /* æ¬„ä½å¯¬åº¦èˆ‡éš±è—é‚è¼¯ */
        /* é›»è…¦ç‰ˆé è¨­ */
        th:nth-child(1) { width: 15%; } /* æ™‚é–“ */
        th:nth-child(2) { width: 8%; }  /* ID */
        th:nth-child(3) { width: 30%; } /* åç¨± */
        th:nth-child(4) { width: 20%; } /* åœ°é» */
        th:nth-child(5) { width: 27%; } /* èªªæ˜ */

        /* æ‰‹æ©Ÿç‰ˆ (ç›´å¼) */
        @media (max-width: 600px) {
            th:nth-child(2), td:nth-child(2) { display: none; } /* éš±è— ID */
            th:nth-child(5), td:nth-child(5) { display: none; } /* éš±è— èªªæ˜ (æ”¹é»æ“Šå±•é–‹) */
            
            th:nth-child(1) { width: 22%; } /* æ™‚é–“ */
            th:nth-child(3) { width: 45%; } /* åç¨± */
            th:nth-child(4) { width: 33%; } /* åœ°é» */
            
            h1 { font-size: 1.2rem; }
            td { padding: 10px 5px; }
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <label for="userSelect">ğŸ‘¤ è«‹é¸æ“‡åƒåŠ è€…ï¼š</label>
        <select id="userSelect" onchange="renderTable()">
            <option value="" disabled selected>è¼‰å…¥è³‡æ–™ä¸­...</option>
        </select>
        <div style="font-size:0.8rem; color:#666; margin-top:5px; text-align:right;">(ğŸ’¡ æ‰‹æ©Ÿç‰ˆé»æ“Šè­°ç¨‹å¯æŸ¥çœ‹èªªæ˜)</div>
    </div>

    <div class="table-container">
        <div id="loading">æ­£åœ¨è®€å– Excel æª”æ¡ˆ...</div>
        <table id="scheduleTable" style="display:none;">
            <thead>
                <tr>
                    <th>æ™‚é–“</th>
                    <th>ID</th>
                    <th>è­°ç¨‹åç¨±</th>
                    <th>åœ°é»</th>
                    <th>ä¸­æ–‡èªªæ˜</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        let scheduleData = [];
        let allAttendees = new Set(); // ä½¿ç”¨ Set è‡ªå‹•éæ¿¾é‡è¤‡çš„äººå

        // 1. è®€å– Excel æª”æ¡ˆå‡½å¼
        async function loadExcel() {
            try {
                // é€™è£¡æŒ‡å®šè¦è®€å–çš„æª”åï¼Œå¿…é ˆè·Ÿæ‚¨çš„ Excel æª”åä¸€æ¨£
                //const response = await fetch('./schedule.xlsx');
                const timestamp = new Date().getTime(); 
                const response = await fetch('./schedule.xlsx?t=' + timestamp); 
                
                if (!response.ok) {
                    throw new Error("ç„¡æ³•æ‰¾åˆ° schedule.xlsxï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦å·²ä¸Šå‚³ä¸”åç¨±æ­£ç¢ºã€‚");
                }

                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, {type: 'array'});
                
                // è®€å–ç¬¬ä¸€å€‹å·¥ä½œè¡¨
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // è½‰æ›ç‚º JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                processData(jsonData);

            } catch (error) {
                document.getElementById('loading').innerHTML = "âŒ è®€å–å¤±æ•—ï¼š<br>" + error.message + "<br><br>(è«‹æ³¨æ„ï¼šæ­¤åŠŸèƒ½éœ€ä¸Šå‚³è‡³ä¼ºæœå™¨æ‰èƒ½é‹ä½œï¼Œç„¡æ³•ç›´æ¥åœ¨é›»è…¦é–‹å•Ÿ)";
                document.getElementById('loading').style.color = "red";
            }
        }

        // 2. è™•ç†è³‡æ–™
        function processData(data) {
            scheduleData = data;
            
            // æ”¶é›†æ‰€æœ‰åƒåŠ è€…åå–®
            data.forEach(row => {
                if (row.Users) {
                    // å°‡ "ç‹å°æ˜ã€æå¤§è¯" åˆ‡å‰²æˆé™£åˆ—
                    // æ”¯æ´é “è™Ÿã€é€—è™Ÿæˆ–ç©ºæ ¼åˆ†éš”
                    const names = row.Users.toString().split(/[ã€,ï¼Œ\s]+/);
                    names.forEach(name => {
                        if (name && name.trim() !== "") {
                            allAttendees.add(name.trim());
                        }
                    });
                }
            });

            // åˆå§‹åŒ–é¸å–®
            initMenu();
            // é¡¯ç¤ºè¡¨æ ¼
            document.getElementById('loading').style.display = 'none';
            document.getElementById('scheduleTable').style.display = 'table';
            renderTable();
        }

        // 3. åˆå§‹åŒ–ä¸‹æ‹‰é¸å–®
        function initMenu() {
            const select = document.getElementById('userSelect');
            select.innerHTML = '<option value="ALL">ğŸ“‹ é¡¯ç¤ºæ‰€æœ‰è­°ç¨‹</option>';
            
            // å°‡ Set è½‰ç‚º Array ä¸¦æ’åº
            const sortedAttendees = Array.from(allAttendees).sort();
            
            sortedAttendees.forEach(name => {
                if (name === "å…¨å“¡") return; // "å…¨å“¡" ä¸éœ€è¦å‡ºç¾åœ¨é¸å–®ä¸­ï¼Œæœƒè‡ªå‹•è™•ç†
                let option = document.createElement('option');
                option.value = name;
                option.textContent = "ğŸ‘¤ " + name;
                select.appendChild(option);
            });
        }

        // 4. æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const select = document.getElementById('userSelect');
            const tbody = document.getElementById('tableBody');
            const selectedUser = select.value;
            
            tbody.innerHTML = "";
            let count = 0;

            scheduleData.forEach(item => {
                let showRow = false;
                let highlightRow = false;

                // è™•ç† Users æ¬„ä½ (å¯èƒ½ç‚º undefined)
                let itemUsers = item.Users ? item.Users.toString() : "";
                let isAll = (item.All && (item.All === "X" || item.All === true || item.All === "TRUE")) || itemUsers.includes("å…¨å“¡");

                if (selectedUser === "ALL") {
                    showRow = true;
                } else {
                    // æª¢æŸ¥æ˜¯å¦åŒ…å«é¸å–çš„äºº
                    if (isAll || itemUsers.includes(selectedUser)) {
                        showRow = true;
                        highlightRow = true;
                    }
                }

                if (showRow) {
                    let tr = document.createElement('tr');
                    if (highlightRow) tr.classList.add('highlight');

                    // é»æ“Šå±•é–‹è©³ç´°èªªæ˜
                    tr.onclick = function() {
                        var nextRow = this.nextElementSibling;
                        if (nextRow && nextRow.className.indexOf('detail-row') > -1) {
                            nextRow.style.display = (nextRow.style.display === 'table-row') ? 'none' : 'table-row';
                        }
                    };

                    // å¡«å…¥è³‡æ–™ (é˜²æ­¢ undefined)
                    tr.innerHTML = `
                        <td>${item.Time || ''}</td>
                        <td>${item.ID || ''}</td>
                        <td>${item.Name || ''}</td>
                        <td>${item.Location || ''}</td>
                        <td>${item.Desc || ''}</td>
                    `;
                    tbody.appendChild(tr);

                    // å»ºç«‹è©³ç´°è³‡è¨Šåˆ— (çµ¦æ‰‹æ©Ÿç‰ˆé»æ“Šç”¨)
                    if (item.Desc) {
                        let trDetail = document.createElement('tr');
                        trDetail.className = 'detail-row';
                        trDetail.innerHTML = `<td colspan="5" class="detail-cell"><strong>ğŸ“ èªªæ˜ï¼š</strong>${item.Desc}</td>`;
                        tbody.appendChild(trDetail);
                    }
                    count++;
                }
            });

            if (count === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px; color:#888;">æ²’æœ‰ç¬¦åˆçš„è­°ç¨‹</td></tr>';
            }
        }

        // å•Ÿå‹•
        loadExcel();

    </script>

</body>
</html>